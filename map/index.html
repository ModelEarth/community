<!DOCTYPE html>
<html>
<head>
<title>Smart & Mobile</title>
<link rel="icon" type="image/x-icon" href="../img/logo/favicon.png" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<!--
  Angshuman Guin
  Senior Research Engineer
  Transportation Systems Engineering
  Smart Cities
  https://ce.gatech.edu/people/faculty/1251/overview

  Technology-Enabled Smarter Safer Routes to School for the City of Milton, GA
  http://smartcities.ipat.gatech.edu/sites/default/files/CityOfMilton_SmarterSaferRoutesToSchool.pdf
-->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
crossorigin=""/>
 <!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
crossorigin=""></script>

<script src="https://d3js.org/d3.v5.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>

<script type="text/javascript" src="../js/common/showdown.min.js"></script>
<script type="text/javascript" src="../js/jquery/zepto.min.js"></script>

<link rel="stylesheet" href="../css/community.css" />

<script type="text/javascript" src="../js/common/common.js"></script>
<script type="text/javascript" src="../js/common/navigation.js"></script>
<link rel="stylesheet" href="../css/display.css" />

  <!-- https://github.com/ilyankou/Leaflet.IconMaterial -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="../css/leaflet/leaflet.icon-material.css" rel="stylesheet">
  <script src="../js/leaflet/leaflet.icon-material.js"></script>

  <style>
    body { font-size: 14px; }
    #map { height: 600px; }
    aside, pre { display: none; }
    div#allLegends { position: relative; }
    div.legend { position: relative; width: 200px; float: left; }
    .padding-left {
      padding-left:70px;
    }
    .headerLogo {
      height:40px;
      margin:28px 10px 4px 50px
    }

    .topLinks {
        z-index: 99999;
        padding: 20px 20px 20px 50px;
        font-size: 18px;
    }
    .topLinks a {
        color: #777;
        text-decoration: underline;
    }
    @media (max-width: 800px) {
      .padding-left {
        padding-left:0px;
      }
    }
    .my-div-icon {
      width: 24px !important;
      height: 20px !important;
      background-color: red;
      position:relative;
    }
    .my-div-icon:after {
      position: absolute;
      /* content: " (" attr(href) ")"; */
      content: "1";
      color: #fff;
      font-size: 14px;
      font-weight: 400;
      line-height: 20px;
      text-align: center;
      left: 0;
      right: 0;
    }
  </style>
</head>
<body>
<a name="top"></a>
<div id="header"></div>
<div style="height:60px"></div>

<a name="map"></a>

<!-- 1. + 2. insert aside block + data -->
<aside class="myDataset">
group,lat,lon,index,address
BK,48.157630,11.648014,1800,lothringer
BK,48.141579,11.604729,100,sdakjh
BK,48.143640,11.603463,1800,dsfasfslk 3.
BK,48.157630,11.648014,1800,loithringer
BK,48.141579,11.604729,100,sdakjh
BK,48.143640,11.603463,1800,dsfasfslk 3.
BK,48.143827,11.602895,500, sadkfjalsfj
BK,48.143640,11.603463,,dsfasfslk 3.
BK,48.143827,11.602895,, sadkfjalsfj
BK,48.144099,11.602444,120, hansenstrasse 4A
</aside>

<aside class="d2">
group,lat,lon,value
KK,48.157630,11.648014,30
KK,48.141579,11.604729,1800
KK,48.143640,11.603463,200
</aside>

<aside class="Intermodal_Ports">
group,lat,lon,value,address,city,state,zip
Inman Rail Yard,33.795735,-84.439278,NS,1600 Marietta Rd NW,Atlanta,GA,30318
Savannah Yard,32.069578,-81.142174,CSX,3000 Tremont Ave,Savannah,GA,31405
James D. Mason ICTF,32.123934,-81.150914,NS,3 North Main St,Garden City,GA,31408
Fairburn Industry Yard,33.554907,-84.595026,CSX,6700 McLarin Rd,Fairburn,GA,30213
Whitaker Rail Yard,33.80944,-84.655451,NS,6000 Westside Rd,Austell,GA,30106
Chatham ICTF,32.125311,-81.151331,CSX,2 Main St,Garden City,GA,31408
Savannah,32.10035,-81.169963,NS,1 Charlie Gay Drive,Savannah,GA,31408
Cordele Intermodal Center,31.966779,-83.755101,Heart GA,2902 East 13th Ave.,Cordele,GA,31010
Port of Savannah Ocean Terminal,32.093702,-81.111692,"Ro/Ro, Breakbulk",55 N Lathrop Ave,Savannah,GA,31415
Port of Brunswick,31.125887,-81.541194,"Ro/Ro, Agri-Bulk",157 Penniman Cir,Brunswick,GA,31523
Port of Savannah,32.125311,-81.151331,Container,2 Main St,Savannah,GA,31407
Port of Brunswick Mayor's Point Terminal,31.143373,-81.494753,Breakbulk,1100 Bay Street,Brunswick,GA,31520
Port of Columbus,32.448734,-84.984038,Liquid Bulk,800 Lumpkin Blvd,Columbus,GA,31901
Port of Bainbridge,30.902867,-84.606259,Liquid/Dry Bulk,1321 Spring Creek Road,Bainbridge,GA,39817
</aside>

<!--
group,lat,lon,value
KI,48.157630,11.648014,Sepp
KI,48.141579,11.604729,Schorsch
KI,48.143640,11.603463,Hans
-->
  
  <style>
      #floatingButtons {
        display:none;
        height:50px;
        right: 30px;
        position:fixed;
        bottom:0;
        z-index:9999;
      }

      #flexwrapper {
        display: flex;
        justify-content: space-between;
        position: relative;
      }
      #hublist {
        overflow: auto;
        width:60%;
        padding-right:40px
      }
      #mapHolder {
        width: 40%;
        /* Show box for testing scroll */
        /* border: 1px solid #ccc; */

        position: relative;
      }
      #mapHolderFixed {
        position: fixed;
        width: 40%;
        padding-rightX: 30px; /* since fix is relative to page */
        box-sizing: border-box;
      }
      #mapHolderInner {
        widthX:100%;
        margin-right: 80px;
        border: 1px solid #999;
      }
      #maptop {
        z-index: 9999999;
      }
      #map {
        height: 500px;
        rightX: 0;
        widthX: 100%;
        box-sizing: border-box;
      }


      @media (max-width: 800px) {
        
        
        #flexwrapper {
          display: block;
        }
        #hublist {
          width:auto;
          
        }
        .padding-left {
          padding-left: 30px;
        }
        #mapHolder {
          width: auto;
          height:400px;
          margin-top: 70px;
          margin-left: 30px;
          margin-bottom: 30px;
        }
        #mapHolderFixed {
          position: relative;
          width: auto;
        }
        #mapHolderInner {
          height:400px;
          margin-right: 30px;
          border: 0px solid #fff;
        }

        #hublist {
          margin-left: 30px;
          margin-right: 30px;
        }

        #floatingButtons {
          display:block;
        }
      }
    </style>

  <br><br>
  <div id="flexwrapper">

    <div id="hublist" class="padding-left">
      <a name="list"></a>
      <h1 style="margin-bottom:0px">Smart & Mobile</h1>

      <h3 style="margin-top:0px; margin-bottom:20px; font-size: 1.24em;">Data Driven Decision Making</h3>
      <!--Opportunities for Waze integration:<br><br>-->

      <div id="detaillist"></div>
      <div id="narrowlist" style="display:none"></div>
    </div>

    <a name="gomap"></a>
    <div id="mapHolder">
      <div id="mapHolderFixed">
        <div id="mapHolderInner">
          <!--div id="maptop">maptop</div-->
          <div id="map"></div>
        </div>
      </div>
    </div>


    <div id="allLegends"></div>
  </div>


    

    
    <br><br>

    
    <div style="clear:both"></div>

    <div class="padding-left" style="overflow:auto; min-width: 300px; margin:0 30px; margin-bottom:30px">
      <a name="items"></a>

      <div id="readmeDiv"></div><br>

      

      

      <!--
      <a href="https://waze.com/carpool" target="waze_carpool">Waze Carpool</a><br><br>
      -->
      

      <!--
        https://www.amazon.com/biodegradable-diapers/s?k=biodegradable+diapers
      -->
    </div>

    
    <div class="sectionMargin" style="max-width: 1200px">
      
      <script>
          /**
           *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT 
           *  THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR 
           *  PLATFORM OR CMS.
           *  
           *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: 
           *  https://disqus.com/admin/universalcode/#configuration-variables
           */
          /*
          var disqus_config = function () {
              // Replace PAGE_URL with your page's canonical URL variable
              this.page.url = PAGE_URL;  
              
              // Replace PAGE_IDENTIFIER with your page's unique identifier variable
              this.page.identifier = PAGE_IDENTIFIER; 
          };
          */
          
          (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
              var d = document, s = d.createElement('script');
              
              // IMPORTANT: Replace locally with your forum shortname!
              s.src = 'https://locally.disqus.com/embed.js';
              
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
          })();
      </script>
      <noscript>
          Please enable JavaScript to view the 
          <a href="https://disqus.com/?ref_noscript" rel="nofollow">
              comments powered by Disqus.
          </a>
      </noscript>
    </div>
    <style>
      .sectionMargin {
        margin:0 50px 0 90px;
      }
      @media (max-width: 700px) {
        .sectionMargin {
          margin-left: 30px;
        }
        #hublist {
          padding-left: 0px;
        }
      }


      .footerButton {
        font-size: 10pt;
        padding: 4px 8px 4px 8px;
        border-radius: 8px;
        min-height: 32px;
        height: 32px;
        background-color: #fff;
        color: #777;
        border: 3px solid #aaa;
        text-decoration: none !important;
      }
      .footerButton:hover {
        color:#fff;
        background: #777;
      }
    </style>

    



  <div id="floatingButtons">
    <div style="padding-right:30px;float:right">
      <a href="#gomap" class="footerButton">Map</a>
      <a href="#list" class="footerButton">List</a>
      <!--
      <a href="#items" class="footerButton">Items</a>
      -->
    </div>
  </div>

  
    <div style="clear:both; margin-top: 20px; padding:30px; background: #eee; z-index: 2000">
      <!-- gets overlapped
      <a href="https://GitHub.com/modelearth/community/tree/master/map" target="_blank">Edit on GitHub</a>
      -->

      <h2>Share a Ride</h2>

      <a href="https://waze.com/carpool" target="waze_carpool">Waze Carpool</a> - Find carpool riders and drivers near you.<br><br>

    </div>


    <script>
      // Set your own Mapbox access token below.
      // Restrict which domains your token is loaded through.
      // https://blog.mapbox.com/url-restrictions-for-access-tokens-5f7f7eb90092

      var mbAttrX = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
          '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
          'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
          mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZWUyZGV2IiwiYSI6ImNqaWdsMXJvdTE4azIzcXFscTB1Nmcwcm4ifQ.hECfwyQtM7RtkBtydKpc5g';
      var mbAttr = '',
          mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZWUyZGV2IiwiYSI6ImNqaWdsMXJvdTE4azIzcXFscTB1Nmcwcm4ifQ.hECfwyQtM7RtkBtydKpc5g';

      var grayscale = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr}),
          satellite = L.tileLayer(mbUrl, {id: 'mapbox.satellite',   attribution: mbAttr}),
          streets = L.tileLayer(mbUrl, {id: 'mapbox.streets',   attribution: mbAttr});

      //var layerGroups = {};
      var dataParameters = []; 
      var dp = {};
      var layerControl = false;

      //////////////////////////////////////////////////////////////////
      // Usage:
      //
      // data: csv file with 
      //  lon, lat for position
      //  one numerical or categorical attribute to be visualized
      //  + (optional) one attribute calles "address" to be shown in tooltip
      // 
      // 1. set class of aside element above to match the name of the data
      // 2. insert data into aside element
      // 3. specify the following dp (data parameters) 
      // 4. initialize map center with [lat, lon]
      // 5. Load Layers Asynchronously
      //
      // options for scales:
      // "scaleThreshold", "scaleOrdinal", "scaleOrdinal" or "scaleQuantile"
      //////////////////////////////////////////////////////////////////

      /////////// LOAD FROM HTML ///////////

      // ------> for more html datasets, copy FROM here
      // dataset 1
      
      dp = {
        selector: "aside.myDataset",
        delimiter: ",",
        numColumns: ["lat","lon","index","address"],
        valueColumn: "index",
        scaleType: "scaleThreshold",
      }
      dp.name = dp.selector.split(".").pop(); // name: myDataset
      // specify end
      dp.data = readData(dp.selector, dp.delimiter, dp.numColumns, dp.valueColumn);
      dp.scale = getScale(dp.data, dp.scaleType, dp.valueColumn);
      dp.group = L.layerGroup();
      //dataParameters.push(dp); // Adds to layer menu - Uncomment to reactivate
      //addCircles(dp);
      //addLegend(dp.scale, dp.scaleType, dp.name);
      
      // ------> for more html datasets, copy TO here

      // dataset 2 - Example of scaled with color-code for 7 ranges
      /*
      dp = {
        selector: "aside.d2",
        delimiter: ",",
        numColumns: ["lat","lon","value"],
        valueColumn: "value",
        scaleType: "scaleQuantize",
      }
      dp.name = dp.selector.split(".").pop(); // name: d2
      dp.data = readData(dp.selector, dp.delimiter, dp.numColumns, dp.valueColumn);
      dp.scale = getScale(dp.data, dp.scaleType, dp.valueColumn);
      dp.group = L.layerGroup();
      dataParameters.push(dp);
      addCircles(dp);
      addLegend(dp.scale, dp.scaleType, dp.name);
      */

      // 3. dataset 3
      dp = {
        selector: "aside.Intermodal_Ports",
        delimiter: ",",
        numColumns: ["lat","lon"],
        valueColumn: "value",
        scaleType: "scaleOrdinal",
        //scaleType: "scaleQuantile",
      }
      //dp.name = dp.selector.split(".").pop(); // name: Intermodal_Ports
      dp.name = "Intermodal Ports"
      dp.data = readData(dp.selector, dp.delimiter, dp.numColumns, dp.valueColumn);
      dp.scale = getScale(dp.data, dp.scaleType, dp.valueColumn);
      dp.group = L.layerGroup();
      dataParameters.push(dp);
      addCircles(dp);
      // Reactivate once colors differ
      //addLegend(dp.scale, dp.scaleType, dp.name);



      function loadFromCSV() {
        // 5. Load Layers Asynchronously
        //var dataset = "../community/map/zip/basic/places.csv";

        // Change below
        // latColumn: "lat",
        //      lonColumn: "lon",
        //var dataset = "https://datascape.github.io/community/map/zip/basic/places.csv";

        var dataset = "map.csv";

        d3.csv(dataset).then(function(d) {
            dp = {
              numColumns: ["zip","lat","lon"],
              valueColumn: "name",
              latColumn: "lat",
              lonColumn: "lon",
              //scaleType: "scaleQuantile",
              scaleType: "scaleOrdinal",
            }
            dp.name = "Smart Data Projects"; // Must match "map.addLayer(overlays" below.
            dp.data = readCsvData(d, dp.numColumns, dp.valueColumn);
            dp.scale = getScale(dp.data, dp.scaleType, dp.valueColumn);
            dp.group = L.layerGroup();
            dataParameters.push(dp);
            overlays[dp.name] = dp.group; // Allows for use of dp.name with removeLayer and addLayer

            if(layerControl === false) {
              layerControl = L.control.layers(baseLayers, overlays).addTo(map);
            }
            layerControl.addOverlay(dp.group, dp.name); // Appends to existing layers
            //addCircles(dp);
            addIcons(dp);
            //addLegend(dp.scale, dp.scaleType, dp.name); // Reactivate

            showList(dp);

            // All layers reside in this object:
            console.log("dataParameters:");
            console.log(dataParameters);

            // Remove from control and background.
            //layerControl.removeLayer(grayscale);
            //map.removeLayer(grayscale);

            
            //layerControl.removeLayer(overlays["myDataset"]); // Remove from control 
            //map.removeLayer(overlays["myDataset"]); // Remove from map

            map.addLayer(overlays["Smart Data Projects"]);
        })
        .catch(function(error){ 
             alert("Data loading error: " + error)
        })
      }
      loadFromCSV();


      /////////// MAP SETTINGS ///////////
      
      // 33.863516,-84.368775
      var mapCenter = [32.90,-83.35]; // [latitude, longitude]

      var map = L.map('map', {
        center: mapCenter,
        scrollWheelZoom: true,
        zoom: 7,
        layers: [grayscale]
      });
      // layers: [grayscale, dataParameters[0].group]

      var baseLayers = {
        "Grayscale": grayscale,
        "Streets": streets,
        "Satellite": satellite
      };

      var overlays = {};
      dataParameters.forEach(function(ele) {
        overlays[ele.name] = ele.group; // Add to layer menu
      })
      if(layerControl === false) {
        layerControl = L.control.layers(baseLayers, overlays).addTo(map);
      }


        // Sample of single icon - place in addIcons function
        // Create a semi-transparent bus icon
        var busIcon = L.IconMaterial.icon({
          icon: 'local_shipping',            // Name of Material icon
          iconColor: '#fff',              // Material icon color (could be rgba, hex, html name...)
          markerColor: 'rgba(255,0,0,0.5)',  // Marker fill color
          outlineColor: 'rgba(255,0,0,0.5)',            // Marker outline color
          outlineWidth: 1,                   // Marker outline width 
        })
        
        // Attach the icon to the marker and add to the map
        //L.marker([33.74,-84.38], {icon: busIcon}).addTo(map)
        
        // Set .my-div-icon styles in CSS
        //var myIcon = L.divIcon({className: 'my-div-icon'});
        //L.marker([32.90,-83.83], {icon: myIcon}).addTo(map);


      /////////////////////////////////////////
      // helper functions
      /////////////////////////////////////////
      function addLegend(scale, scaleType, title) {
        var svg = d3.select("#allLegends")
          .append("div")
            .attr("class", "legend "  + title)
          .append("svg")
            .style("width", 200);
            // .styleX("height", 300)

        svg.append("g")
            .attr("class", "legend")
            .attr("transform", "translate(20,20)");

        var legend = d3.legendColor()
          .labelFormat(d3.format(".2f"))
          .title(title);
      
        if (scaleType === "scaleThreshold") {
          legend = legend.labels(d3.legendHelpers.thresholdLabels);
        }

        legend.scale(scale);  

        svg.select("g.legend")
          .call(legend);
      }
      
      function addCircles(dp) {
        var circle;
        var colorScale = dp.scale;
        dp.data.forEach(function(element) {
          // How to make element always lowercase?
          console.log("element " + element)
          if (typeof dp.latColumn == "undefined") {
            dp.latColumn = "lat";
          }
          if (typeof dp.lonColumn == "undefined") {
            dp.lonColumn = "lon";
          }
          circle = L.circle([element[dp.latColumn], element[dp.lonColumn]], {
              color: colorScale(element[dp.valueColumn]),
              fillColor: colorScale(element[dp.valueColumn]),
              fillOpacity: 1,
              radius: 500 // was 50
          }).addTo(dp.group);

          var output = "<b>" + element[dp.valueColumn] + "</b><br>" + element.address + "<br>" + element.city + " " + element.state + " " + element.zip + "<br>" + element.phone + " " + element.phone_afterhours + "<br>";
            if (element.schedule) {
              output += "Hours: " + element.schedule + "<br>";
            }
          if (element[dp.latColumn]) {
              output += "<a href='https://www.waze.com/ul?ll=" + element[dp.latColumn] + "%2C" + element[dp.lonColumn] + "&navigate=yes&zoom=17'>Waze  Directions</a><br>";
          }
          circle.bindPopup(output);
            // "<br>Latitude: " + element[dp.latColumn] + 

          //alert(output);
        });
      }


      function hex2rgb(hex) {
        // long version
        r = hex.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);
        if (r) {
          return r.slice(1,4).map(function(x) { return parseInt(x, 16); });
        }
        // short version
        r = hex.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);
        if (r) {
          return r.slice(1,4).map(function(x) { return 0x11 * parseInt(x, 16); });
        }
        return null;
      }

      //alert(hex2rgb("#0033ff")); // a pretty blue;

      function addIcons(dp) {
        var circle;
        var iconColor, iconColorRGB;
        var colorScale = dp.scale;
        dp.data.forEach(function(element) {
          iconColor = colorScale(element[dp.valueColumn]);
          // How to make element always lowercase?
          console.log("element " + element + " iconColor: " + iconColor)
          if (typeof dp.latColumn == "undefined") {
            dp.latColumn = "lat";
          }
          if (typeof dp.lonColumn == "undefined") {
            dp.lonColumn = "lon";
          }
          iconColorRGB = hex2rgb(iconColor);

        var busIcon = L.IconMaterial.icon({
          icon: 'star',            // Name of Material icon
          iconColor: '#fff',              // Material icon color (could be rgba, hex, html name...)
          markerColor: 'rgba(' + iconColorRGB + ',0.7)',  // Marker fill color
          outlineColor: 'rgba(' + iconColorRGB + ',0.7)',            // Marker outline color
          outlineWidth: 1,                   // Marker outline width 
        })
        
        // Attach the icon to the marker and add to the map
        //L.marker([element[dp.latColumn], element[dp.lonColumn]], {icon: busIcon}).addTo(map)
        circle = L.marker([element[dp.latColumn], element[dp.lonColumn]], {icon: busIcon}).addTo(dp.group);


          var output = "<b>" + element[dp.valueColumn] + "</b><br>" + element.address + "<br>" + element.city + " " + element.state + " " + element.zip + "<br>" + element.phone + " " + element.phone_afterhours + "<br>";
          if (element.schedule) {
            output += "Hours: " + element.schedule + "<br>";
          }
          if (element[dp.latColumn]) {
              output += "<a href='https://www.waze.com/ul?ll=" + element[dp.latColumn] + "%2C" + element[dp.lonColumn] + "&navigate=yes&zoom=17'>Waze  Directions</a><br>";
          }
          circle.bindPopup(output);
            // "<br>Latitude: " + element[dp.latColumn] + 

          //alert(output);
        });
      }

      function showList(dp) {

        var colorScale = dp.scale;
        dp.data.forEach(function(element) {


          var output = "<div style='width:15px;height:15px;margin-right:8px;margin-top:3px;background:" + colorScale(element[dp.valueColumn]) + ";float:left'></div><div style='overflow:auto'>"
          output += "<b style='font-size:16px;color:#333'>" + element[dp.valueColumn] + "</b><br>" + element.address + "<br>" + element.city + " " + element.state + " " + element.zip + "<br>";
          if (element.phone || element.phone_afterhours) {
           output += element.phone + " " + element.phone_afterhours + "<br>";
          }
          if (element.schedule) {
           output += "Hours: " + element.schedule + "<br>";
          }
           if (element[dp.latColumn]) {
              output += "<a href='https://www.waze.com/ul?ll=" + element[dp.latColumn] + "%2C" + element[dp.lonColumn] + "&navigate=yes&zoom=17'>Waze Directions</a><br>";
          }
           output += "<br></div><div style='clear:both'></div>";

          $("#narrowlist").append(output);

          // Detail List with Descriptions
          output = "<div style='width:15px;height:15px;margin-right:8px;margin-top:3px;background:" + colorScale(element[dp.valueColumn]) + ";float:left'></div><div style='overflow:auto'>"
          output += "<b style='font-size:16px;color:#333'>" + element.title + "</b><br>";

          output += element.description + "<br>";

          /*
          output += "<b>" + element.name + "</b> " + element.address + ", " + element.city + " " + element.state + " " + element.zip + " ";
          if (element.phone || element.phone_afterhours) {
           output += element.phone + " " + element.phone_afterhours + "<br>";
          }
          if (element.schedule) {
           output += "Hours: " + element.schedule + "<br>";
          }
           if (element[dp.latColumn]) {
              output += " - <a href='https://www.waze.com/ul?ll=" + element[dp.latColumn] + "%2C" + element[dp.lonColumn] + "&navigate=yes&zoom=17'>Waze Directions</a><br>";
          }
          */

          if (element.website) {
            // Learn More:
            output += "<a href='" + element.website + "' style='display:block;margin-top:5px' target='_blank'>" + element.website.replace("https://","").replace("http://","").replace("www.","") + "</a><br>";
          }
          output += "</div><div style='clear:both'></div>";

          $("#detaillist").append(output);


        });
      }

      // see also: http://d3indepth.com/scales/
      function getScale(data, scaleType, valueCol) {
        var scale;
        if (scaleType === "scaleThreshold") {
          var min = d3.min(data, function(d) { return d[valueCol]; });
          var max = d3.max(data, function(d) { return d[valueCol]; });
          var d = (max-min)/7;
          scale = d3.scaleThreshold()
            .domain([min+1*d,min+2*d,min+3*d,min+4*d,min+5*d,min+6*d])
            .range(['#ffffe0','#ffd59b','#ffa474','#f47461','#db4551','#b81b34','#8b0000']);
        } else if (scaleType === "scaleQuantize") {
          scale = d3.scaleQuantize()
            .domain(d3.extent(data, function(d) { return d[valueCol]; }))
            .range(['#ffffe0','#ffd59b','#ffa474','#f47461','#db4551','#b81b34','#8b0000']);
        } else if (scaleType === "scaleQuantile") {
          scale = d3.scaleQuantile()
            .domain(data.map(function(d) { return d[valueCol]; }).sort(function(a, b){return a-b}))
            .range(['#ffffe0','#ffd59b','#ffa474','#f47461','#db4551','#b81b34','#8b0000']);            
        } else if (scaleType === "scaleOrdinal") {
          scale = d3.scaleOrdinal()
            .domain(data.map(function(d) { return d[valueCol]; }))
            .range(d3.schemePaired);
        }
        return scale;
      }

      function readData(selector, delimiter, columnsNum, valueCol) {
        var psv = d3.dsvFormat(delimiter);
        var initialData = psv.parse(removeWhiteSpaces(d3.select(selector).text())); 
        _data = initialData.filter(function(e) { return e[valueCol].length !== 0; });
        console.log("Skipped: " + (initialData.length - _data.length) + " rows.");
        
        if (typeof columnsNum !== "undefined") {
          _data.forEach( function (row) {
            convertToNumber(row, columnsNum);
          });
        }
        //console.log(_data);
        return _data;
      }
      function readCsvData(_data, columnsNum, valueCol) {
        //console.log(_data);
        
        if (typeof columnsNum !== "undefined") {
          _data.forEach( function (row) {
            //row = removeWhiteSpaces(row);
            convertToNumber(row, columnsNum);
          });
        }
        console.log(_data);
        return _data;
      }
      function convertToNumber(d, _columnsNum) {
        for (var perm in d) {
          if (_columnsNum.indexOf(perm) > -1)
            if (Object.prototype.hasOwnProperty.call(d, perm)) {
              d[perm] = +d[perm];
            }
          }  
        return d;
      } 
	  
	  function removeWhiteSpaces (str) {
		  return str.replace(/^\s+|\s+$|\s+(?=\s)/g, "");
	  }
    </script>

    <script>
  loadMarkupPage("README.md", "readmeDiv", "_parent");
</script>
<link rel="stylesheet" href="../css/material_icons.css" />
  </body>
</html>